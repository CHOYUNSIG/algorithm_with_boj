<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <!-- 그림자 필터 정의 -->
    <svg xmlns="http://www.w3.org/2000/svg" width="0" height="0">
      <defs>
        <filter id="drop-shadow" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur in="SourceAlpha" stdDeviation="3"/> <!-- stdDeviation is how much to blur -->
          <feOffset dx="0" dy="2" result="offsetblur"/> <!-- how much to offset -->
          <feFlood flood-color="#555" result="color"/> <!-- 색상 변경을 위해 feFlood 추가 -->
          <feComposite in2="offsetblur" operator="in"/> <!-- 그림자의 색상을 변경하기 위해 feComposite 추가 -->
          <feComponentTransfer>
            <feFuncA type="linear" slope="1"/> <!-- slope is the opacity of the shadow -->
          </feComponentTransfer>
          <feMerge> 
            <feMergeNode/> <!-- this contains the offset blurred image -->
            <feMergeNode in="SourceGraphic"/> <!-- this contains the element that the filter is applied to -->
          </feMerge>
        </filter>
      </defs>
    </svg>

    <div class="post-content e-content" itemprop="articleBody">

      {{ content }}

    </div>

    <script>
      // h2 태그를 제목으로 하고 있는 본문을 div로 묶음
      var postContentDiv = document.querySelector('div.post-content');
      var divContainer = [];

      while (postContentDiv.children.length > 0) {
        var currentElement = postContentDiv.children[0];
        if (currentElement.tagName.toLowerCase() === 'h2') {
          var newDiv = document.createElement('div');
          newDiv.classList.add('post-section');
          divContainer.push(newDiv);
        }
        divContainer[divContainer.length - 1].appendChild(currentElement);
      }

      for (var i = 0; i < divContainer.length; i++) {
        postContentDiv.appendChild(divContainer[i]);
      }
    </script>

    <script>
      // 포스트 내 테이블의 overflow 방지 및 margin 추가
      var postContentDiv = document.querySelector('div.post-content');
      var tables = postContentDiv.querySelectorAll('table');
      tables.forEach(function(table) {
        var div = document.createElement('div');
        div.classList.add('post-table');
        table.parentNode.replaceChild(div, table);
        div.appendChild(table);
      });
    </script>

    <script type="module">
      // Mermaid 그리기
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'
      mermaid.initialize({ startOnLoad: false });
      await mermaid.run({
        querySelector: '.mermaid',
      });
      // Mermaid 노드에 그림자 추가
      const mermaidPre = document.querySelectorAll('pre.mermaid');
      for (var i = 0; i < mermaidPre.length; i++) {
        const current = mermaidPre[i].children[0];
        ['rect', 'circle'].map( shape => {
          const drawElement = current.querySelectorAll(shape);
          for (var j = 0; j < drawElement.length; j++) {
            drawElement[j].setAttribute("filter", `url(#drop-shadow)`);
          }
        });
      }
    </script>

</article>
